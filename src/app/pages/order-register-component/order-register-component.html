<div class="title">Gestión de Órdenes</div>
<div class="crud-wrapper">

<div class="filters">

  <mat-form-field appearance="fill" class="filter-box">
    <mat-label>Filtrar reserva</mat-label>
    <input
      matInput
      (keyup)="applyFilter($event)"
      placeholder="Filtrar por fecha, usuario ..."
    />
    <mat-icon matSuffix>search</mat-icon>
  </mat-form-field>


  <mat-form-field appearance="fill">
    <mat-label>Tipo</mat-label>
    <mat-select [(ngModel)]="filterType" (selectionChange)="applyFilters()">
      <mat-option value="">Todos</mat-option>
      <mat-option value="LOCAL">Local</mat-option>
      <mat-option value="DELIVERY">Delivery</mat-option>
    </mat-select>
  </mat-form-field>

  <mat-form-field appearance="fill">
    <mat-label>Estado</mat-label>
    <mat-select [(ngModel)]="filterStatus" (selectionChange)="applyFilters()">
      <mat-option value="">Todos</mat-option>
      <mat-option value="PENDING">Pendiente</mat-option>
      <mat-option value="CONFIRMED">Confirmado</mat-option>
      <mat-option value="COMPLETED">Completado</mat-option>
      <mat-option value="CANCELLED">Cancelado</mat-option>
    </mat-select>
  </mat-form-field>

  <button mat-button class="btn-clear" (click)="clearFilters()">
    <mat-icon>auto_delete</mat-icon>Limpiar</button>
</div>


  <!-- TABLA GLASS -->
  <div class="mat-elevation-z8 table-card table-responsive" >
    <table mat-table [dataSource]="dataSource" matSort class="glass-table">
      <!-- ID -->
      <ng-container matColumnDef="idOrder">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>ID</th>
        <td mat-cell *matCellDef="let r">{{ r.idOrder }}</td>
      </ng-container>

      <!-- Usuario -->
      <ng-container matColumnDef="user">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Usuario</th>
        <td mat-cell *matCellDef="let r">{{ r.userName}}</td>
      </ng-container>

      <!-- Mesa -->
      <ng-container matColumnDef="table">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Mesa</th>
        <td mat-cell *matCellDef="let r">Mesa {{ r.tableNumber}}</td>
      </ng-container>

      <!-- Fecha -->
      <ng-container matColumnDef="createdAt">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Fecha</th>
        <td mat-cell *matCellDef="let r">
          {{ r.createdAt | date : "dd/MM/yyyy" }}
        </td>
      </ng-container>

      <ng-container matColumnDef="type">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Tipo de Orden</th>
        <td mat-cell *matCellDef="let r">{{ r.orderType}}</td>
      </ng-container>

      <ng-container matColumnDef="total">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Total</th>
        <td mat-cell *matCellDef="let r">{{ r.totalAmount}}</td>
      </ng-container>


      <!-- ESTADO (badge moderno) -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Estado</th>
        <td mat-cell *matCellDef="let row">
          <span class="status-badge" [class.active]="row.status === 'CONFIRMADA'" 
                                      [class.pendiente]="row.status === 'PENDIENTE'" 
                                    [class.inactive]="row.status === 'CANCELADA'">
            {{ row.status }}
          </span>
        </td>
      </ng-container>

      <!-- Acciones -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Acciones</th>
        <td mat-cell *matCellDef="let r">

          <button mat-icon-button color="accent" (click)="openPayDialog(r)">
            <mat-icon>payment</mat-icon>
          </button>


          <button mat-icon-button class="btn-edit"  [routerLink]="['/pages/order', r.idOrder]">
            <mat-icon>edit</mat-icon>
          </button>
          <button
            mat-icon-button
            class="btn-delete"
            (click)="delete(r.idOrder)"
          >
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="getDisplayedColumns()"></tr>
      <tr mat-row *matRowDef="let row; columns: getDisplayedColumns()"></tr>
    </table>

    <!-- PAGINACIÓN -->
    <mat-paginator
      class="glass-paginator"
      [pageSizeOptions]="[5, 10, 25, 100]"
      aria-label="Select page of items"
    >
    </mat-paginator>
    <!-- BOTÓN FLOTANTE ADD -->
    <button mat-fab class="fab-add" [routerLink]="'/pages/order'">
      <mat-icon>add</mat-icon>
    </button>
  </div>
</div>